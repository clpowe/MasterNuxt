var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,v,r){k!=Array.prototype&&k!=Object.prototype&&(k[v]=r.value)};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(k,v,r,p){if(v){r=$jscomp.global;k=k.split(".");for(p=0;p<k.length-1;p++){var t=k[p];t in r||(r[t]={});r=r[t]}k=k[k.length-1];p=r[k];v=v(p);v!=p&&null!=v&&$jscomp.defineProperty(r,k,{configurable:!0,writable:!0,value:v})}};$jscomp.polyfill("Math.sign",function(k){return k?k:function(k){k=Number(k);return 0===k||isNaN(k)?k:0<k?1:-1}},"es6","es3");
(function(k){"object"===typeof exports&&"undefined"!==typeof module?module.exports=k():"function"===typeof define&&define.amd?define([],k):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).imsc=k()})(function(){return function(){function k(v,r,p){function t(n,G){if(!r[n]){if(!v[n]){var a="function"==typeof require&&require;if(!G&&a)return a(n,!0);if(m)return m(n,!0);G=Error("Cannot find module '"+n+"'");throw G.code="MODULE_NOT_FOUND",G;}G=
r[n]={exports:{}};v[n][0].call(G.exports,function(a){return t(v[n][1][a]||a)},G,G.exports,k,v,r,p)}return r[n].exports}for(var m="function"==typeof require&&require,n=0;n<p.length;n++)t(p[n]);return t}return k}()({1:[function(k,v,r){(function(p,k,m,n,r){function t(b){if("contents"in b){var a="styleAttrs"in b?b.styleAttrs[n.byName.ruby.qname]:null;a="span"===b.kind&&("container"===a||"textContainer"===a||"baseContainer"===a);for(var c=b.contents.length-1;0<=c;c--)!a||"styleAttrs"in b.contents[c]&&
n.byName.ruby.qname in b.contents[c].styleAttrs?t(b.contents[c]):delete b.contents[c]}}function a(b,c,h,d){var e=d&&"seq"===d.timeContainer,A=0;d&&(A=e&&h?h.end:d.begin);c.begin=c.explicit_begin?c.explicit_begin+A:A;h=c.begin;d=null;for(var f in c.sets)a(b,c.sets[f],d,c),h="seq"===c.timeContainer?c.sets[f].end:Math.max(h,c.sets[f].end),d=c.sets[f];if("contents"in c)for(var l in c.contents)a(b,c.contents[l],d,c),h="seq"===c.timeContainer?c.contents[l].end:Math.max(h,c.contents[l].end),d=c.contents[l];
else h=e?c.begin:Number.POSITIVE_INFINITY;c.end=null!==c.explicit_end&&null!==c.explicit_dur?Math.min(c.begin+c.explicit_dur,A+c.explicit_end):null===c.explicit_end&&null!==c.explicit_dur?c.begin+c.explicit_dur:null!==c.explicit_end&&null===c.explicit_dur?A+c.explicit_end:h;delete c.explicit_begin;delete c.explicit_dur;delete c.explicit_end;b._registerEvent(c)}function e(b){this.node=b}function g(){this.events=[];this.head=new l;this.body=null}function l(){this.styling=new D;this.layout=new v}function D(){this.styles=
{};this.initials={}}function B(){this.styleRefs=this.styleAttrs=this.id=null}function C(){this.styleAttrs=null}function v(){this.regions={}}function z(b,c){this.kind="image";this.src=b;this.type=c}function b(b){this.id=b}function h(b){this.regionID=b}function c(b){this.styleAttrs=b}function d(b){this.sets=b}function H(b){this.contents=b}function f(b,c,a){this.explicit_begin=b;this.explicit_end=c;this.explicit_dur=a}function P(){this.kind="body"}function q(){this.kind="div"}function L(){this.kind=
"p"}function u(){this.kind="span"}function M(){this.kind="span"}function R(){this.kind="br"}function w(){}function O(){}function U(b){return b&&"xml:id"in b.attributes?b.attributes["xml:id"].value||null:null}function N(b){return b&&"style"in b.attributes?b.attributes.style.value.split(" "):[]}function F(b,c){var a={};if(null!==b)for(var h in b.attributes){var d=b.attributes[h].uri+" "+b.attributes[h].local,e=n.byQName[d];if(void 0!==e){var f=e.parse(b.attributes[h].value);null!==f?(a[d]=f,e===n.byName.zIndex&&
J(c,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):I(c,"Cannot parse styling attribute "+d+" --\x3e "+b.attributes[h].value)}}return a}function K(b,c,a){for(var h in b.attributes)if(b.attributes[h].uri===c&&b.attributes[h].local===a)return b.attributes[h].value;return null}function Y(b,c){b=K(b,m.ns_tts,"extent");if(null===b)return null;var a=b.split(" ");if(2!==a.length)return J(c,"Malformed extent (ignoring)"),null;b=r.parseLength(a[0]);a=r.parseLength(a[1]);return a&&
b?{h:a,w:b}:(J(c,"Malformed extent values (ignoring)"),null)}function S(b,c,a){var h=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,d=/^(\d{2,}):(\d\d):(\d\d):(\d{2,})$/,e=/^(\d+(?:\.\d+)?)t$/,f=/^(\d+(?:\.\d+)?)ms$/,l=/^(\d+(?:\.\d+)?)s$/,g=/^(\d+(?:\.\d+)?)h$/,A=/^(\d+(?:\.\d+)?)m$/,y,m=null;null!==(y=/^(\d+(?:\.\d+)?)f$/.exec(a))?null!==c&&(m=parseFloat(y[1])/c):null!==(y=e.exec(a))?null!==b&&(m=parseFloat(y[1])/b):null!==(y=f.exec(a))?m=parseFloat(y[1])/1E3:null!==(y=l.exec(a))?m=parseFloat(y[1]):null!==
(y=g.exec(a))?m=3600*parseFloat(y[1]):null!==(y=A.exec(a))?m=60*parseFloat(y[1]):null!==(y=h.exec(a))?m=3600*parseInt(y[1])+60*parseInt(y[2])+parseFloat(y[3]):null!==(y=d.exec(a))&&null!==c&&(m=3600*parseInt(y[1])+60*parseInt(y[2])+parseInt(y[3])+(null===y[4]?0:parseInt(y[4])/c));return m}function V(b,c,a){for(;0<c.styleRefs.length;){var h=c.styleRefs.pop();h in b.styles?(V(b,b.styles[h],a),T(b.styles[h].styleAttrs,c.styleAttrs)):I(a,"Non-existant style id referenced")}}function W(b,c,a,h){for(var d=
c.length-1;0<=d;d--){var e=c[d];e in b.styles?T(b.styles[e].styleAttrs,a):I(h,"Non-existant style id referenced")}}function T(b,c){for(var a in b)a in c||(c[a]=b[a])}function J(b,c){if(b&&b.warn&&b.warn(c))throw c;}function I(b,c){if(b&&b.error&&b.error(c))throw c;}function E(b,c){b&&b.fatal&&b.fatal(c);throw c;}function X(b,c){for(var a=0,h=b.length-1,d;a<=h;){d=Math.floor((a+h)/2);var e=b[d];if(e<c)a=d+1;else if(e>c)h=d-1;else return{found:!0,index:d}}return{found:!1,index:a}}p.fromXML=function(b,
c,h){var d=k.parser(!0,{xmlns:!0}),f=[],A=[],y=[],H=0,x=null;d.onclosetag=function(b){if(f[0]instanceof w)null!==x.head&&null!==x.head.styling&&W(x.head.styling,f[0].styleRefs,f[0].styleAttrs,c),delete f[0].styleRefs;else if(f[0]instanceof D)for(var a in f[0].styles)V(f[0],f[0].styles[a],c);else if(f[0]instanceof L||f[0]instanceof u){if(1<f[0].contents.length){b=[f[0].contents[0]];for(a=1;a<f[0].contents.length;a++)f[0].contents[a]instanceof M&&b[b.length-1]instanceof M?b[b.length-1].text+=f[0].contents[a].text:
b.push(f[0].contents[a]);f[0].contents=b}f[0]instanceof u&&1===f[0].contents.length&&f[0].contents[0]instanceof M&&(f[0].text=f[0].contents[0].text,delete f[0].contents)}else if(f[0]instanceof e)if(f[0].node.uri===m.ns_tt&&"metadata"===f[0].node.local)H--;else if(0<H&&h&&"onCloseTag"in h)h.onCloseTag();y.shift();A.shift();f.shift()};d.ontext=function(b){if(void 0!==f[0])if(f[0]instanceof u||f[0]instanceof L){if(f[0]instanceof u){var a=f[0].styleAttrs[n.byName.ruby.qname];if("container"===a||"textContainer"===
a||"baseContainer"===a)return}a=new M;a.initFromText(x,f[0],b,A[0],y[0],c);f[0].contents.push(a)}else if(f[0]instanceof e&&0<H&&h&&"onText"in h)h.onText(b)};d.onopentag=function(b){var a=b.attributes["xml:space"];a?y.unshift(a.value):0===y.length?y.unshift("default"):y.unshift(y[0]);(a=b.attributes["xml:lang"])?A.unshift(a.value):0===A.length?A.unshift(""):A.unshift(A[0]);if(b.uri===m.ns_tt)if("tt"===b.local)null!==x&&E(c,"Two <tt> elements at ("+this.line+","+this.column+")"),x=new g,x.initFromNode(b,
A[0],c),f.unshift(x);else if("head"===b.local)f[0]instanceof g||E(c,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),f.unshift(x.head);else if("styling"===b.local)f[0]instanceof l||E(c,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),f.unshift(x.head.styling);else if("style"===b.local)if(f[0]instanceof D){var d=new B;d.initFromNode(b,c);d.id?x.head.styling.styles[d.id]=d:I(c,"<style> element missing @id attribute");f.unshift(d)}else f[0]instanceof
w?(d=new B,d.initFromNode(b,c),T(d.styleAttrs,f[0].styleAttrs),f.unshift(d)):E(c,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")");else if("initial"===b.local)if(f[0]instanceof D){a=new C;a.initFromNode(b,c);for(d in a.styleAttrs)x.head.styling.initials[d]=a.styleAttrs[d];f.unshift(a)}else E(c,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")");else if("layout"===b.local)f[0]instanceof l||E(c,"Parent of <layout> element is not <head> at "+
this.line+","+this.column+")"),f.unshift(x.head.layout);else if("region"===b.local)f[0]instanceof v||E(c,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")"),d=new w,d.initFromNode(x,b,A[0],c),!d.id||d.id in x.head.layout.regions?I(c,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):x.head.layout.regions[d.id]=d,f.unshift(d);else if("body"===b.local)f[0]instanceof g||E(c,"Parent of <body> element is not <tt> at "+this.line+","+this.column+
")"),null!==x.body&&E(c,"Second <body> element at "+this.line+","+this.column+")"),d=new P,d.initFromNode(x,b,A[0],c),x.body=d,f.unshift(d);else if("div"===b.local){f[0]instanceof q||f[0]instanceof P||E(c,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");d=new q;d.initFromNode(x,f[0],b,A[0],c);if(a=d.styleAttrs[n.byName.backgroundImage.qname])d.contents.push(new z(a)),delete d.styleAttrs[n.byName.backgroundImage.qname];f[0].contents.push(d);f.unshift(d)}else"image"===
b.local?(f[0]instanceof q||E(c,"Parent of <image> element is not <div> at "+this.line+","+this.column+")"),d=new z,d.initFromNode(x,f[0],b,A[0],c),f[0].contents.push(d),f.unshift(d)):"p"===b.local?(f[0]instanceof q||E(c,"Parent of <p> element is not <div> at "+this.line+","+this.column+")"),d=new L,d.initFromNode(x,f[0],b,A[0],c),f[0].contents.push(d),f.unshift(d)):"span"===b.local?(f[0]instanceof u||f[0]instanceof L||E(c,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+
")"),d=new u,d.initFromNode(x,f[0],b,A[0],y[0],c),f[0].contents.push(d),f.unshift(d)):"br"===b.local?(f[0]instanceof u||f[0]instanceof L||E(c,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")"),d=new R,d.initFromNode(x,f[0],b,A[0],c),f[0].contents.push(d),f.unshift(d)):"set"===b.local?(f[0]instanceof u||f[0]instanceof L||f[0]instanceof q||f[0]instanceof P||f[0]instanceof w||f[0]instanceof R||E(c,"Parent of <set> element is not a content element or a region at "+this.line+
","+this.column+")"),d=new O,d.initFromNode(x,f[0],b,c),f[0].sets.push(d),f.unshift(d)):f.unshift(new e(b));else f.unshift(new e(b));if(f[0]instanceof e)if(b.uri===m.ns_tt&&"metadata"===b.local)H++;else if(0<H&&h&&"onOpenTag"in h){d=[];for(var p in b.attributes)d[b.attributes[p].uri+" "+b.attributes[p].local]={uri:b.attributes[p].uri,local:b.attributes[p].local,value:b.attributes[p].value};h.onOpenTag(b.uri,b.local,d)}};d.write(b).close();delete x.head.styling.styles;b=!1;for(var p in x.head.layout.regions){b=
!0;break}b||(p=w.prototype.createDefaultRegion(x.lang),x.head.layout.regions[p.id]=p);for(var r in x.head.layout.regions)a(x,x.head.layout.regions[r],null,null);x.body&&a(x,x.body,null,null);x.body&&t(x.body);return x};g.prototype.initFromNode=function(b,c,a){var d=K(b,m.ns_ttp,"cellResolution"),h=15;var f=32;null!==d&&(d=/(\d+) (\d+)/.exec(d),null!==d?(f=parseInt(d[1]),h=parseInt(d[2])):J(a,"Malformed cellResolution value (using initial value instead)"));this.cellLength={h:new r.ComputedLength(0,
1/h),w:new r.ComputedLength(1/f,0)};h=K(b,m.ns_ttp,"frameRate");d=30;null!==h&&(f=/(\d+)/.exec(h),null!==f?d=parseInt(f[1]):J(a,"Malformed frame rate attribute (using initial value instead)"));f=K(b,m.ns_ttp,"frameRateMultiplier");var e=1;null!==f&&(f=/(\d+) (\d+)/.exec(f),null!==f?e=parseInt(f[1])/parseInt(f[2]):J(a,"Malformed frame rate multiplier attribute (using initial value instead)"));d*=e;e=1;f=K(b,m.ns_ttp,"tickRate");null===f?null!==h&&(e=d):(f=/(\d+)/.exec(f),null!==f?e=parseInt(f[1]):
J(a,"Malformed tick rate attribute (using initial value instead)"));this.effectiveFrameRate=d;this.tickRate=e;f=K(b,m.ns_ittp,"aspectRatio");null===f&&(f=K(b,m.ns_ttp,"displayAspectRatio"));h=null;null!==f&&(d=/(\d+)\s+(\d+)/.exec(f),null!==d?(f=parseInt(d[1]),d=parseInt(d[2]),0!==f&&0!==d?h=f/d:I(a,"Illegal aspectRatio values (ignoring)")):I(a,"Malformed aspectRatio attribute (ignoring)"));this.aspectRatio=h;h=K(b,m.ns_ttp,"timeBase");null!==h&&"media"!==h&&E(a,"Unsupported time base");b=Y(b,a);
null===b?this.pxLength={h:null,w:null}:("px"===b.h.unit&&"px"===b.w.unit||E(a,"Extent on TT must be in px or absent"),this.pxLength={h:new r.ComputedLength(0,1/b.h.value),w:new r.ComputedLength(1/b.w.value,0)});this.dimensions={h:new r.ComputedLength(0,1),w:new r.ComputedLength(1,0)};this.lang=c};g.prototype._registerEvent=function(b){if(!(b.end<=b.begin)){var c=X(this.events,b.begin);c.found||this.events.splice(c.index,0,b.begin);b.end!==Number.POSITIVE_INFINITY&&(c=X(this.events,b.end),c.found||
this.events.splice(c.index,0,b.end))}};g.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]};g.prototype.getMediaTimeEvents=function(){return this.events};B.prototype.initFromNode=function(b,c){this.id=U(b);this.styleAttrs=F(b,c);this.styleRefs=N(b)};C.prototype.initFromNode=function(b,c){this.styleAttrs={};for(var a in b.attributes)if(b.attributes[a].uri===m.ns_itts||b.attributes[a].uri===m.ns_ebutts||b.attributes[a].uri===m.ns_tts)this.styleAttrs[b.attributes[a].uri+
" "+b.attributes[a].local]=b.attributes[a].value};z.prototype.initFromNode=function(b,a,e,l,g){(this.src="src"in e.attributes?e.attributes.src.value:null)||I(g,"Invalid image@src attribute");(this.type="type"in e.attributes?e.attributes.type.value:null)||I(g,"Invalid image@type attribute");c.prototype.initFromNode.call(this,b,a,e,g);f.prototype.initFromNode.call(this,b,a,e,g);d.prototype.initFromNode.call(this,b,a,e,g);h.prototype.initFromNode.call(this,b,a,e,g);this.lang=l};b.prototype.initFromNode=
function(b,c,a,d){this.id=U(a)};h.prototype.initFromNode=function(b,c,a,d){this.regionID=a&&"region"in a.attributes?a.attributes.region.value:""};c.prototype.initFromNode=function(b,c,a,d){this.styleAttrs=F(a,d);null!==b.head&&null!==b.head.styling&&W(b.head.styling,N(a),this.styleAttrs,d)};d.prototype.initFromNode=function(b,c,a,d){this.sets=[]};H.prototype.initFromNode=function(b,c,a,d){this.contents=[]};f.prototype.initFromNode=function(b,c,a,d){c=null;a&&"begin"in a.attributes&&(c=S(b.tickRate,
b.effectiveFrameRate,a.attributes.begin.value),null===c&&J(d,"Malformed begin value "+a.attributes.begin.value+" (using 0)"));var f=null;a&&"dur"in a.attributes&&(f=S(b.tickRate,b.effectiveFrameRate,a.attributes.dur.value),null===f&&J(d,"Malformed dur value "+a.attributes.dur.value+" (ignoring)"));var h=null;a&&"end"in a.attributes&&(h=S(b.tickRate,b.effectiveFrameRate,a.attributes.end.value),null===h&&J(d,"Malformed end value (ignoring)"));this.explicit_begin=c;this.explicit_end=h;this.explicit_dur=
f;(b=a&&"timeContainer"in a.attributes?a.attributes.timeContainer.value:null)&&"par"!==b?"seq"===b?d="seq":(I(d,"Illegal value of timeContainer (assuming 'par')"),d="par"):d="par";this.timeContainer=d};P.prototype.initFromNode=function(b,a,e,l){c.prototype.initFromNode.call(this,b,null,a,l);f.prototype.initFromNode.call(this,b,null,a,l);d.prototype.initFromNode.call(this,b,null,a,l);h.prototype.initFromNode.call(this,b,null,a,l);H.prototype.initFromNode.call(this,b,null,a,l);this.lang=e};q.prototype.initFromNode=
function(b,a,e,l,g){c.prototype.initFromNode.call(this,b,a,e,g);f.prototype.initFromNode.call(this,b,a,e,g);d.prototype.initFromNode.call(this,b,a,e,g);h.prototype.initFromNode.call(this,b,a,e,g);H.prototype.initFromNode.call(this,b,a,e,g);this.lang=l};L.prototype.initFromNode=function(b,a,e,l,g){c.prototype.initFromNode.call(this,b,a,e,g);f.prototype.initFromNode.call(this,b,a,e,g);d.prototype.initFromNode.call(this,b,a,e,g);h.prototype.initFromNode.call(this,b,a,e,g);H.prototype.initFromNode.call(this,
b,a,e,g);this.lang=l};u.prototype.initFromNode=function(b,a,e,l,g,m){c.prototype.initFromNode.call(this,b,a,e,m);f.prototype.initFromNode.call(this,b,a,e,m);d.prototype.initFromNode.call(this,b,a,e,m);h.prototype.initFromNode.call(this,b,a,e,m);H.prototype.initFromNode.call(this,b,a,e,m);this.space=g;this.lang=l};M.prototype.initFromText=function(b,a,c,d,h,e){f.prototype.initFromNode.call(this,b,a,null,e);this.text=c;this.space=h;this.lang=d};R.prototype.initFromNode=function(b,a,c,d,e){h.prototype.initFromNode.call(this,
b,a,c,e);f.prototype.initFromNode.call(this,b,a,c,e);this.lang=d};w.prototype.createDefaultRegion=function(b){var a=new w;a.id="";a.styleAttrs={};a.sets=[];f.call(a,0,Number.POSITIVE_INFINITY,null);this.lang=b;return a};w.prototype.initFromNode=function(a,c,h,e){b.prototype.initFromNode.call(this,a,null,c,e);f.prototype.initFromNode.call(this,a,null,c,e);d.prototype.initFromNode.call(this,a,null,c,e);this.styleAttrs=F(c,e);this.styleRefs=N(c);this.lang=h};O.prototype.initFromNode=function(b,a,c,d){f.prototype.initFromNode.call(this,
b,a,c,d);b=F(c,d);this.value=this.qname=null;for(var h in b){if(this.qname){I(d,"More than one style specified on set");break}this.qname=h;this.value=b[h]}}})("undefined"===typeof r?this.imscDoc={}:r,"undefined"===typeof sax?k("sax"):sax,"undefined"===typeof imscNames?k("./names"):imscNames,"undefined"===typeof imscStyles?k("./styles"):imscStyles,"undefined"===typeof imscUtils?k("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7,sax:void 0}],2:[function(k,v,r){(function(p,k,m){function n(b,
h,c,d){if("region"===c.kind){var g=document.createElement("div");g.style.position="absolute"}else if("body"===c.kind)g=document.createElement("div");else if("div"===c.kind)g=document.createElement("div");else if("image"===c.kind){if(g=document.createElement("img"),null!==b.imgResolver&&null!==c.src){var f=b.imgResolver(c.src,g);f&&(g.src=f);g.height=b.regionH;g.width=b.regionW}}else if("p"===c.kind)g=document.createElement("p");else if("span"===c.kind)if("container"===c.styleAttrs[m.byName.ruby.qname])g=
document.createElement("ruby"),b.ruby=!0;else if("base"===c.styleAttrs[m.byName.ruby.qname])g=document.createElement("rb");else if("text"===c.styleAttrs[m.byName.ruby.qname])g=document.createElement("rt");else if("baseContainer"===c.styleAttrs[m.byName.ruby.qname])g=document.createElement("rbc");else if("textContainer"===c.styleAttrs[m.byName.ruby.qname])g=document.createElement("rtc");else{if("delimiter"===c.styleAttrs[m.byName.ruby.qname])return;g=document.createElement("span")}else"br"===c.kind&&
(g=document.createElement("br"));if(g){!c.lang||"region"!==c.kind&&c.lang===d.lang||(g.lang=c.lang);h.appendChild(g);g.style.margin="0";if("region"===c.kind)if(h=c.styleAttrs[m.byName.writingMode.qname],"lrtb"===h||"lr"===h)b.ipd="lr",b.bpd="tb";else if("rltb"===h||"rl"===h)b.ipd="rl",b.bpd="tb";else if("tblr"===h)b.ipd="tb",b.bpd="lr";else{if("tbrl"===h||"tb"===h)b.ipd="tb",b.bpd="rl"}else"p"===c.kind&&"tb"===b.bpd&&(b.ipd="ltr"===c.styleAttrs[m.byName.direction.qname]?"lr":"rl");for(var p in l)h=
l[p],d=c.styleAttrs[h.qname],void 0!==d&&null!==h.map&&h.map(b,g,c,d);p=g;(h=c.styleAttrs[m.byName.linePadding.qname])&&!h.isZero()&&(d=h.toUsedLength(b.w,b.h),0<d&&(d=Math.ceil(d)+"px","tb"===b.bpd?(p.style.paddingLeft=d,p.style.paddingRight=d):(p.style.paddingTop=d,p.style.paddingBottom=d),b.lp=h));(h=c.styleAttrs[m.byName.multiRowAlign.qname])&&"auto"!==h&&(p=document.createElement("span"),p.style.display="inline-block",p.style.textAlign=h,g.appendChild(p),b.mra=h);(h=c.styleAttrs[m.byName.rubyReserve.qname])&&
"none"!==h[0]&&(b.rubyReserve=h);c.styleAttrs[m.byName.fillLineGap.qname]&&(b.flg=!0);if("span"===c.kind&&c.text)if((h=c.styleAttrs[m.byName.textEmphasis.qname])&&"none"!==h.style&&(b.textEmphasis=!0),m.byName.textCombine.qname in c.styleAttrs&&"all"===c.styleAttrs[m.byName.textCombine.qname])g.textContent=c.text,h&&e(b,g,c,h);else for(d="",f=0;f<c.text.length;f++){d+=c.text.charAt(f);var q=c.text.charCodeAt(f);if(55296>q||56319<q||f===c.text.length)q=document.createElement("span"),q.textContent=
d,h&&e(b,q,c,h),g.appendChild(q),d=""}for(var k in c.contents)n(b,p,c.contents[k],c);k=[];if((b.lp||b.mra||b.flg||b.ruby||b.textEmphasis||b.rubyReserve)&&"p"===c.kind){a(b,p,k,null);if(b.rubyReserve){for(h=0;h<k.length;h++){d=document.createElement("ruby");f=document.createElement("rb");f.textContent="\u200b";d.appendChild(f);var u=b.rubyReserve[1].toUsedLength(b.w,b.h)+"px";"both"===b.rubyReserve[0]||"outside"===b.rubyReserve[0]&&1==k.length?(f=document.createElement("rtc"),f.style[C]=B?"after":
"under",f.textContent="\u200b",f.style.fontSize=u,q=document.createElement("rtc"),q.style[C]=B?"before":"over",q.textContent="\u200b",q.style.fontSize=u,d.appendChild(f),d.appendChild(q)):(f=document.createElement("rtc"),f.textContent="\u200b",f.style.fontSize=u,f.style[C]="after"===b.rubyReserve[0]||"outside"===b.rubyReserve[0]&&0<h?B?"after":"tb"===b.bpd||"rl"===b.bpd?"under":"over":B?"before":"tb"===b.bpd||"rl"===b.bpd?"over":"under",d.appendChild(f));f=null;for(q=0;q<k[h].rbc.length;q++)if("ruby"===
k[h].rbc[q].localName){f=k[h].rbc[q];for(q=0;q<f.style.length;q++)d.style.setProperty(f.style.item(q),f.style.getPropertyValue(f.style.item(q)));break}f=f||k[h].elements[0].node;f.parentElement.insertBefore(d,f)}b.rubyReserve=null}if(b.ruby||b.rubyReserve){for(h=0;h<k.length;h++)for(d=0;d<k[h].rbc.length;d++)k[h].rbc[d].style[C]||(k[h].rbc[d].style[C]=B?0===h?"before":"after":"tb"===b.bpd?0===h?"over":"under":"rl"===b.bpd?0===h?"over":"under":0===h?"under":"over");b.ruby=null}if(b.textEmphasis){for(h=
0;h<k.length;h++)for(d=0;d<k[h].te.length;d++)k[h].te[d].style[z]&&"none"!==k[h].te[d].style[z]||(k[h].te[d].style[z]="tb"===b.bpd?0===h?"left over":"left under":"rl"===b.bpd?0===h?"right under":"left under":0===h?"left under":"right under");b.textEmphasis=null}if(b.mra){for(h=0;h<k.length-1;h++)f=k[h].elements.length,0!==f&&!1===k[h].br&&(d=document.createElement("br"),f=k[h].elements[f-1].node,f.parentElement.insertBefore(d,f.nextSibling));b.mra=null}if(b.lp){h=b.lp.toUsedLength(b.w,b.h);for(var D in k)d=
k[D].elements[k[D].start_elem],f=k[D].elements[k[D].end_elem],q=Math.ceil(h)+"px",u="-"+Math.ceil(h)+"px",0!==k[D].elements.length&&("lr"===b.ipd?(d.node.style.borderLeftColor=d.bgcolor||"#00000000",d.node.style.borderLeftStyle="solid",d.node.style.borderLeftWidth=q,d.node.style.marginLeft=u):"rl"===b.ipd?(d.node.style.borderRightColor=d.bgcolor||"#00000000",d.node.style.borderRightStyle="solid",d.node.style.borderRightWidth=q,d.node.style.marginRight=u):"tb"===b.ipd&&(d.node.style.borderTopColor=
d.bgcolor||"#00000000",d.node.style.borderTopStyle="solid",d.node.style.borderTopWidth=q,d.node.style.marginTop=u),"lr"===b.ipd?(f.node.style.borderRightColor=f.bgcolor||"#00000000",f.node.style.borderRightStyle="solid",f.node.style.borderRightWidth=q,f.node.style.marginRight=u):"rl"===b.ipd?(f.node.style.borderLeftColor=f.bgcolor||"#00000000",f.node.style.borderLeftStyle="solid",f.node.style.borderLeftWidth=q,f.node.style.marginLeft=u):"tb"===b.ipd&&(f.node.style.borderBottomColor=f.bgcolor||"#00000000",
f.node.style.borderBottomStyle="solid",f.node.style.borderBottomWidth=q,f.node.style.marginBottom=u));b.lp=null}if(b.flg){h=r(p.getBoundingClientRect(),b);D=h.before;h=h.after;d=Math.sign(h-D);for(f=0;f<=k.length;f++){q=0===f?D:f===k.length?h:(k[f].before+k[f-1].after)/2;if(0<f)for(var v=0;v<k[f-1].elements.length;v++)if(null!==k[f-1].elements[v].bgcolor){var w=k[f-1].elements[v];0>d*(w.after-q)&&(u=Math.ceil(Math.abs(q-w.after))+"px",w.node.style.backgroundColor=w.bgcolor,"lr"===b.bpd?w.node.style.paddingRight=
u:"rl"===b.bpd?w.node.style.paddingLeft=u:"tb"===b.bpd&&(w.node.style.paddingBottom=u))}if(f<k.length)for(v=0;v<k[f].elements.length;v++)w=k[f].elements[v],null!==w.bgcolor&&0<d*(w.before-q)&&(u=Math.ceil(Math.abs(w.before-q))+"px",w.node.style.backgroundColor=w.bgcolor,"lr"===b.bpd?w.node.style.paddingLeft=u:"rl"===b.bpd?w.node.style.paddingRight=u:"tb"===b.bpd&&(w.node.style.paddingTop=u))}b.flg=null}}"region"===c.kind&&(a(b,p,k),"tb"===b.bpd&&b.enableRollUp&&0<c.contents.length&&"after"===c.styleAttrs[m.byName.displayAlign.qname]&&
(c=new t(""===c.id?"_":c.id,k),b.currentISDState[c.id]=c,b.previousISDState&&c.id in b.previousISDState&&0<b.previousISDState[c.id].plist.length&&1<c.plist.length&&c.plist[c.plist.length-2].text===b.previousISDState[c.id].plist[b.previousISDState[c.id].plist.length-1].text&&(b=g.firstElementChild,c=c.plist[c.plist.length-1].after-c.plist[c.plist.length-1].before,b.style.bottom="-"+c+"px",b.style.transition="transform 0.4s",b.style.position="relative",b.style.transform="translateY(-"+c+"px)")))}else if(b=
b.errorHandler,c="Error processing ISD element kind: "+c.kind,b&&b.error&&b.error(c))throw c;}function t(b,a){this.id=b;this.plist=a}function r(b,a){var c={before:null,after:null,start:null,end:null};"tb"===a.bpd?(c.before=b.top,c.after=b.bottom,"lr"===a.ipd?(c.start=b.left,c.end=b.right):(c.start=b.right,c.end=b.left)):"lr"===a.bpd?(c.before=b.left,c.after=b.right,c.start=b.top,c.end=b.bottom):"rl"===a.bpd&&(c.before=b.right,c.after=b.left,c.start=b.top,c.end=b.bottom);return c}function a(b,h,c,
d){if("rt"!==h.localName&&"rtc"!==h.localName)if(d=h.style.backgroundColor||d,0===h.childElementCount)if("span"===h.localName||"rb"===h.localName){var e=h.getBoundingClientRect();if(0!==e.height&&0!==e.width){b=r(e,b);if(!(e=0===c.length)){e=b.before;var f=b.after,g=c[c.length-1].before,l=c[c.length-1].after;e=!(f<l&&e>g||l<=f&&g>=e)}e?c.push({before:b.before,after:b.after,start:b.start,end:b.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1}):(e=Math.sign(b.after-b.before),f=Math.sign(b.end-
b.start),0>e*(b.before-c[c.length-1].before)&&(c[c.length-1].before=b.before),0<e*(b.after-c[c.length-1].after)&&(c[c.length-1].after=b.after),0>f*(b.start-c[c.length-1].start)&&(c[c.length-1].start=b.start,c[c.length-1].start_elem=c[c.length-1].elements.length),0<f*(b.end-c[c.length-1].end)&&(c[c.length-1].end=b.end,c[c.length-1].end_elem=c[c.length-1].elements.length));c[c.length-1].text+=h.textContent;c[c.length-1].elements.push({node:h,bgcolor:d,before:b.before,after:b.after})}}else"br"===h.localName&&
0!==c.length&&(c[c.length-1].br=!0);else for(h=h.firstChild;h;)h.nodeType===Node.ELEMENT_NODE&&(a(b,h,c,d),"ruby"===h.localName||"rtc"===h.localName?0<c.length&&c[c.length-1].rbc.push(h):"span"===h.localName&&h.style[v]&&"none"!==h.style[v]&&0<c.length&&c[c.length-1].te.push(h)),h=h.nextSibling}function e(b,a,c,d){"none"!==d.style&&(a.style[v]="auto"===d.style?"filled":d.style+" "+d.symbol,"before"===d.position||"after"===d.position)&&(a.style[z]="tb"===b.bpd?"before"===d.position?"left over":"left under":
"rl"===b.bpd?"before"===d.position?"right under":"left under":"before"===d.position?"left under":"right under")}function g(b,a){this.qname=b;this.map=a}p.render=function(b,a,c,d,e,f,g,l,m){d=d||a.clientHeight;e=e||a.clientWidth;if(null!==b.aspectRatio){var h=d*b.aspectRatio;h>e?d=Math.round(e/b.aspectRatio):e=h}h=document.createElement("div");h.style.position="relative";h.style.width=e+"px";h.style.height=d+"px";h.style.margin="auto";h.style.top=0;h.style.bottom=0;h.style.left=0;h.style.right=0;h.style.zIndex=
0;c={h:d,w:e,regionH:null,regionW:null,imgResolver:c,displayForcedOnlyMode:f||!1,isd:b,errorHandler:g,previousISDState:l,enableRollUp:m||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};a.appendChild(h);for(var B in b.contents)n(c,h,b.contents[B],b);return c.currentISDState};var l=[new g("http://www.w3.org/ns/ttml#styling backgroundColor",function(b,a,c,d){0!==d[3]&&(a.style.backgroundColor="rgba("+d[0].toString()+","+d[1].toString()+
","+d[2].toString()+","+(d[3]/255).toString()+")")}),new g("http://www.w3.org/ns/ttml#styling color",function(b,a,c,d){a.style.color="rgba("+d[0].toString()+","+d[1].toString()+","+d[2].toString()+","+(d[3]/255).toString()+")"}),new g("http://www.w3.org/ns/ttml#styling direction",function(b,a,c,d){a.style.direction=d}),new g("http://www.w3.org/ns/ttml#styling display",function(b,a,c,d){}),new g("http://www.w3.org/ns/ttml#styling displayAlign",function(b,a,c,d){a.style.display="flex";a.style.flexDirection=
"column";"before"===d?a.style.justifyContent="flex-start":"center"===d?a.style.justifyContent="center":"after"===d&&(a.style.justifyContent="flex-end")}),new g("http://www.w3.org/ns/ttml#styling extent",function(b,a,c,d){b.regionH=d.h.toUsedLength(b.w,b.h);b.regionW=d.w.toUsedLength(b.w,b.h);var e=d=0;if(c=c.styleAttrs["http://www.w3.org/ns/ttml#styling padding"])d=c[0].toUsedLength(b.w,b.h)+c[2].toUsedLength(b.w,b.h),e=c[1].toUsedLength(b.w,b.h)+c[3].toUsedLength(b.w,b.h);a.style.height=b.regionH-
d+"px";a.style.width=b.regionW-e+"px"}),new g("http://www.w3.org/ns/ttml#styling fontFamily",function(b,a,c,d){b=[];for(var e in d)"monospaceSerif"===d[e]?(b.push("Courier New"),b.push('"Liberation Mono"'),b.push("Courier"),b.push("monospace")):"proportionalSansSerif"===d[e]?(b.push("Arial"),b.push("Helvetica"),b.push('"Liberation Sans"'),b.push("sans-serif")):"monospace"===d[e]?b.push("monospace"):"sansSerif"===d[e]?b.push("sans-serif"):"serif"===d[e]?b.push("serif"):"monospaceSansSerif"===d[e]?
(b.push("Consolas"),b.push("monospace")):"proportionalSerif"===d[e]?b.push("serif"):b.push(d[e]);a.style.fontFamily=b.join(",")}),new g("http://www.w3.org/ns/ttml#styling shear",function(b,a,c,d){0!==d&&(c=-.9*d,a.style.transform="tb"===b.bpd?"skewX("+c+"deg)":"skewY("+c+"deg)")}),new g("http://www.w3.org/ns/ttml#styling fontSize",function(b,a,c,d){a.style.fontSize=d.toUsedLength(b.w,b.h)+"px"}),new g("http://www.w3.org/ns/ttml#styling fontStyle",function(b,a,c,d){a.style.fontStyle=d}),new g("http://www.w3.org/ns/ttml#styling fontWeight",
function(b,a,c,d){a.style.fontWeight=d}),new g("http://www.w3.org/ns/ttml#styling lineHeight",function(b,a,c,d){a.style.lineHeight="normal"===d?"normal":d.toUsedLength(b.w,b.h)+"px"}),new g("http://www.w3.org/ns/ttml#styling opacity",function(b,a,c,d){a.style.opacity=d}),new g("http://www.w3.org/ns/ttml#styling origin",function(b,a,c,d){a.style.top=d.h.toUsedLength(b.w,b.h)+"px";a.style.left=d.w.toUsedLength(b.w,b.h)+"px"}),new g("http://www.w3.org/ns/ttml#styling overflow",function(b,a,c,d){a.style.overflow=
d}),new g("http://www.w3.org/ns/ttml#styling padding",function(b,a,c,d){c=[];c[0]=d[0].toUsedLength(b.w,b.h)+"px";c[1]=d[3].toUsedLength(b.w,b.h)+"px";c[2]=d[2].toUsedLength(b.w,b.h)+"px";c[3]=d[1].toUsedLength(b.w,b.h)+"px";a.style.padding=c.join(" ")}),new g("http://www.w3.org/ns/ttml#styling position",function(b,a,c,d){a.style.top=d.h.toUsedLength(b.w,b.h)+"px";a.style.left=d.w.toUsedLength(b.w,b.h)+"px"}),new g("http://www.w3.org/ns/ttml#styling rubyAlign",function(b,a,c,d){a.style.rubyAlign=
"spaceAround"===d?"space-around":"center"}),new g("http://www.w3.org/ns/ttml#styling rubyPosition",function(b,a,c,d){if("before"===d||"after"===d)a.parentElement.style[C]=B?d:"tb"===b.bpd?"before"===d?"over":"under":"rl"===b.bpd?"before"===d?"over":"under":"before"===d?"under":"over"}),new g("http://www.w3.org/ns/ttml#styling showBackground",null),new g("http://www.w3.org/ns/ttml#styling textAlign",function(b,a,c,d){a.style.textAlign="start"===d?"rl"===b.ipd?"right":"left":"end"===d?"rl"===b.ipd?
"left":"right":d}),new g("http://www.w3.org/ns/ttml#styling textDecoration",function(b,a,c,d){a.style.textDecoration=d.join(" ").replace("lineThrough","line-through")}),new g("http://www.w3.org/ns/ttml#styling textOutline",function(b,a,c,d){}),new g("http://www.w3.org/ns/ttml#styling textShadow",function(b,a,c,d){var e=c.styleAttrs[m.byName.textOutline.qname];if("none"===d&&"none"===e)a.style.textShadow="";else{c=[];"none"!==e&&(e="rgba("+e.color[0].toString()+","+e.color[1].toString()+","+e.color[2].toString()+
","+(e.color[3]/255).toString()+")",c.push("1px 1px 1px "+e),c.push("-1px 1px 1px "+e),c.push("1px -1px 1px "+e),c.push("-1px -1px 1px "+e));if("none"!==d)for(var f in d)c.push(d[f].x_off.toUsedLength(b.w,b.h)+"px "+d[f].y_off.toUsedLength(b.w,b.h)+"px "+d[f].b_radius.toUsedLength(b.w,b.h)+"px rgba("+d[f].color[0].toString()+","+d[f].color[1].toString()+","+d[f].color[2].toString()+","+(d[f].color[3]/255).toString()+")");a.style.textShadow=c.join(",")}}),new g("http://www.w3.org/ns/ttml#styling textCombine",
function(b,a,c,d){a.style.textCombineUpright=d}),new g("http://www.w3.org/ns/ttml#styling textEmphasis",function(b,a,c,d){}),new g("http://www.w3.org/ns/ttml#styling unicodeBidi",function(b,a,c,d){a.style.unicodeBidi="bidiOverride"===d?"bidi-override":d}),new g("http://www.w3.org/ns/ttml#styling visibility",function(b,a,c,d){a.style.visibility=d}),new g("http://www.w3.org/ns/ttml#styling wrapOption",function(b,a,c,d){a.style.whiteSpace="wrap"===d?"preserve"===c.space?"pre-wrap":"normal":"preserve"===
c.space?"pre":"noWrap"}),new g("http://www.w3.org/ns/ttml#styling writingMode",function(b,a,c,d){if("lrtb"===d||"lr"===d)a.style.writingMode="horizontal-tb";else if("rltb"===d||"rl"===d)a.style.writingMode="horizontal-tb";else if("tblr"===d)a.style.writingMode="vertical-lr";else if("tbrl"===d||"tb"===d)a.style.writingMode="vertical-rl"}),new g("http://www.w3.org/ns/ttml#styling zIndex",function(b,a,c,d){a.style.zIndex=d}),new g("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(b,
a,c,d){b.displayForcedOnlyMode&&!1===d&&(a.style.visibility="hidden")})],D;for(D in l);var B="webkitRubyPosition"in window.getComputedStyle(document.documentElement),C=B?"webkitRubyPosition":"rubyPosition",v="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",z="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition"})("undefined"===typeof r?this.imscHTML=
{}:r,"undefined"===typeof imscNames?k("./names"):imscNames,"undefined"===typeof imscStyles?k("./styles"):imscStyles,"undefined"===typeof imscUtils?k("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],3:[function(k,v,r){(function(k,t,m,n){function p(g,k,t,v,b,h,c,d,H){if(k<c.begin||k>=c.end)return null;h="regionID"in c&&""!==c.regionID?c.regionID:h;if(null!==b&&h!==t.id&&(!("contents"in c)||"contents"in c&&0===c.contents.length||""!==h))return null;var f=new l(c);for(B in c.sets)k<c.sets[B].begin||
k>=c.sets[B].end||(f.styleAttrs[c.sets[B].qname]=c.sets[B].value);var B={};for(var q in f.styleAttrs)if(B[q]=!0,"region"===f.kind&&q===m.byName.writingMode.qname&&!(m.byName.direction.qname in f.styleAttrs)){var z=f.styleAttrs[q];if("lrtb"===z||"lr"===z)f.styleAttrs[m.byName.direction.qname]="ltr";else if("rltb"===z||"rl"===z)f.styleAttrs[m.byName.direction.qname]="rtl"}if(null!==b)for(var u in m.all)if(q=m.all[u],q.qname===m.byName.textDecoration.qname){z=b.styleAttrs[q.qname];var C=f.styleAttrs[q.qname],
G=[];void 0===C?G=z:-1===C.indexOf("none")?((-1===C.indexOf("noUnderline")&&-1!==z.indexOf("underline")||-1!==C.indexOf("underline"))&&G.push("underline"),(-1===C.indexOf("noLineThrough")&&-1!==z.indexOf("lineThrough")||-1!==C.indexOf("lineThrough"))&&G.push("lineThrough"),(-1===C.indexOf("noOverline")&&-1!==z.indexOf("overline")||-1!==C.indexOf("overline"))&&G.push("overline")):G.push("none");f.styleAttrs[q.qname]=G}else q.qname!==m.byName.fontSize.qname||q.qname in f.styleAttrs||"span"!==f.kind||
"textContainer"!==f.styleAttrs[m.byName.ruby.qname]?q.qname!==m.byName.fontSize.qname||q.qname in f.styleAttrs||"span"!==f.kind||"text"!==f.styleAttrs[m.byName.ruby.qname]?q.inherit&&q.qname in b.styleAttrs&&!(q.qname in f.styleAttrs)&&(f.styleAttrs[q.qname]=b.styleAttrs[q.qname]):(z=b.styleAttrs[m.byName.fontSize.qname],f.styleAttrs[q.qname]="textContainer"===b.styleAttrs[m.byName.ruby.qname]?z:new n.ComputedLength(.5*z.rw,.5*z.rh)):(z=b.styleAttrs[m.byName.fontSize.qname],f.styleAttrs[q.qname]=
new n.ComputedLength(.5*z.rw,.5*z.rh));for(var w in m.all)if(u=m.all[w],!(u.qname in f.styleAttrs||u.qname===m.byName.position.qname&&m.byName.origin.qname in f.styleAttrs||u.qname===m.byName.origin.qname&&m.byName.position.qname in f.styleAttrs)&&(q=g.head.styling.initials[u.qname]||u.initial,null!==q&&("region"===f.kind||!1===u.inherit&&null!==q)))if(q=u.parse(q),null!==q)f.styleAttrs[u.qname]=q,B[u.qname]=!0;else if(u="Invalid initial value for '"+u.qname+"' on element '"+f.kind,d&&d.error&&d.error(u))throw u;
for(var O in m.all)if(w=m.all[O],w.qname in B&&null!==w.compute)if(u=w.compute(g,b,f,f.styleAttrs[w.qname],H),null!==u)f.styleAttrs[w.qname]=u;else if(f.styleAttrs[w.qname]=w.compute(g,b,f,w.parse(w.initial),H),w="Style '"+w.qname+"' on element '"+f.kind+"' cannot be computed",d&&d.error&&d.error(w))throw w;if("none"===f.styleAttrs[m.byName.display.qname])return null;if(null===b)var Q=null===v?[]:[v];else"contents"in c&&(Q=c.contents);for(var N in Q)b=p(g,k,t,v,f,h,Q[N],d,H),null!==b&&f.contents.push(b.element);
for(var F in f.styleAttrs)g=!1,"span"===f.kind&&(k=f.styleAttrs[m.byName.ruby.qname],(g=("container"===k||"textContainer"===k||"baseContainer"===k)&&-1!==D.indexOf(F))||(g="container"!==k&&F===m.byName.rubyAlign.qname),g||(g=!("textContainer"===k||"text"===k)&&F===m.byName.rubyPosition.qname)),g||(g=-1===m.byQName[F].applies.indexOf(f.kind)),g&&delete f.styleAttrs[F];F=f.styleAttrs[m.byName.ruby.qname];if("p"===f.kind||"span"===f.kind&&("textContainer"===F||"text"===F))F=[],a(f,F),r(F),e(f);return"div"===
f.kind&&m.byName.backgroundImage.qname in f.styleAttrs||"br"===f.kind||"image"===f.kind||"contents"in f&&0<f.contents.length||"span"===f.kind&&null!==f.text||"region"===f.kind&&"always"===f.styleAttrs[m.byName.showBackground.qname]?{region_id:h,element:f}:null}function r(a){function e(b){return"br"===b.kind||/[\r\n\t ]$/.test(b.text)}function g(b){return"br"===b.kind||"preserve"===b.space&&/^[\r\n]/.test(b.text)}for(var l,b=0;b<a.length;)if(l=a[b],"br"===l.kind||"preserve"===l.space)b++;else{var h=
l.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(h)&&(0===b||e(a[b-1]))&&(h=h.substring(1));l.text=h;0===h.length?a.splice(b,1):b++}for(b=0;b<a.length;b++)l=a[b],"br"===l.kind||"preserve"===l.space?b++:/[ ]$/.test(l.text)&&(b===a.length-1||g(a[b+1]))&&(l.text=l.text.slice(0,-1))}function a(e,g){for(var l in e.contents){var k=e.contents[l],b=k.styleAttrs[m.byName.ruby.qname];if("span"!==k.kind||"textContainer"!==b&&"text"!==b)"contents"in k?a(k,g):("span"===k.kind&&0!==k.text.length||"br"===k.kind)&&
g.push(k)}}function e(a){if("br"===a.kind)return!1;if("text"in a)return 0===a.text.length;if("contents"in a){for(var g=a.contents.length;g--;)e(a.contents[g])&&a.contents.splice(g,1);return 0===a.contents.length}}function g(a){this.contents=[];this.aspectRatio=a.aspectRatio;this.lang=a.lang}function l(a){this.kind=a.kind||"region";this.lang=a.lang;a.id&&(this.id=a.id);this.styleAttrs={};for(var e in a.styleAttrs)this.styleAttrs[e]=a.styleAttrs[e];"src"in a&&(this.src=a.src);"type"in a&&(this.type=
a.type);if("text"in a)this.text=a.text;else if("region"===this.kind||"contents"in a)this.contents=[];"space"in a&&(this.space=a.space)}k.generateISD=function(a,e,l){var m=new g(a),b={},h;for(h in a.head.layout.regions){var c=p(a,e,a.head.layout.regions[h],a.body,null,"",a.head.layout.regions[h],l,b);null!==c&&m.contents.push(c.element)}return m};var D=[m.byName.color.qname,m.byName.textCombine.qname,m.byName.textDecoration.qname,m.byName.textEmphasis.qname,m.byName.textOutline.qname,m.byName.textShadow.qname]})("undefined"===
typeof r?this.imscISD={}:r,"undefined"===typeof imscNames?k("./names"):imscNames,"undefined"===typeof imscStyles?k("./styles"):imscStyles,"undefined"===typeof imscUtils?k("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],4:[function(k,v,r){r.generateISD=k("./isd").generateISD;r.fromXML=k("./doc").fromXML;r.renderHTML=k("./html").render},{"./doc":1,"./html":2,"./isd":3}],5:[function(k,v,r){k="undefined"===typeof r?this.imscNames={}:r;k.ns_tt="http://www.w3.org/ns/ttml";k.ns_tts="http://www.w3.org/ns/ttml#styling";
k.ns_ttp="http://www.w3.org/ns/ttml#parameter";k.ns_xml="http://www.w3.org/XML/1998/namespace";k.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling";k.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter";k.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt";k.ns_ebutts="urn:ebu:tt:style"},{}],6:[function(k,v,r){(function(k,t,m){function n(a,e,g,l,k,m,n,p){this.name=e;this.ns=a;this.qname=a+" "+e;this.inherit=k;this.animatable=m;this.initial=g;this.applies=l;this.parse=n;this.compute=
p}k.all=[new n(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,m.parseColor,null),new n(t.ns_tts,"color","white",["span"],!0,!0,m.parseColor,null),new n(t.ns_tts,"direction","ltr",["p","span"],!0,!0,function(a){return a},null),new n(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(a){return a},null),new n(t.ns_tts,"displayAlign","before",["region"],!1,!0,function(a){return a},null),new n(t.ns_tts,"extent","auto",["tt","region"],!1,!0,function(a){if("auto"===
a)return a;var e=a.split(" ");if(2!==e.length)return null;a=m.parseLength(e[0]);return(e=m.parseLength(e[1]))&&a?{h:e,w:a}:null},function(a,e,g,l,k){if("auto"===l)e=new m.ComputedLength(0,1);else if(e=m.toComputedLength(l.h.value,l.h.unit,null,a.dimensions.h,null,a.pxLength.h),null===e)return null;if("auto"===l)a=new m.ComputedLength(1,0);else if(a=m.toComputedLength(l.w.value,l.w.unit,null,a.dimensions.w,null,a.pxLength.w),null===a)return null;return{h:e,w:a}}),new n(t.ns_tts,"fontFamily","default",
["span","p"],!0,!0,function(a){a=a.split(",");var e=[],g;for(g in a)"'"!==a[g].charAt(0)&&'"'!==a[g].charAt(0)?"default"===a[g]?e.push("monospaceSerif"):e.push(a[g]):e.push(a[g]);return e},null),new n(t.ns_tts,"shear","0%",["p"],!0,!0,m.parseLength,function(a,e,g,l){if("%"===l.unit)a=100<Math.abs(l.value)?100*Math.sign(l.value):l.value;else return null;return a}),new n(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,m.parseLength,function(a,e,g,l,n){return m.toComputedLength(l.value,l.unit,null!==e?e.styleAttrs[k.byName.fontSize.qname]:
a.cellLength.h,null!==e?e.styleAttrs[k.byName.fontSize.qname]:a.cellLength.h,a.cellLength.h,a.pxLength.h)}),new n(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,function(a){return a},null),new n(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,function(a){return a},null),new n(t.ns_tts,"lineHeight","normal",["p"],!0,!0,function(a){return"normal"===a?a:m.parseLength(a)},function(a,e,g,l,n){if("normal"===l)a=l;else if(a=m.toComputedLength(l.value,l.unit,g.styleAttrs[k.byName.fontSize.qname],g.styleAttrs[k.byName.fontSize.qname],
a.cellLength.h,a.pxLength.h),null===a)return null;return a}),new n(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new n(t.ns_tts,"origin","auto",["region"],!1,!0,function(a){if("auto"===a)return a;var e=a.split(" ");if(2!==e.length)return null;a=m.parseLength(e[0]);return(e=m.parseLength(e[1]))&&a?{h:e,w:a}:null},function(a,e,g,l,k){if("auto"===l)e=new m.ComputedLength(0,0);else if(e=m.toComputedLength(l.h.value,l.h.unit,null,a.dimensions.h,null,a.pxLength.h),null===e)return null;if("auto"===
l)a=new m.ComputedLength(0,0);else if(a=m.toComputedLength(l.w.value,l.w.unit,null,a.dimensions.w,null,a.pxLength.w),null===a)return null;return{h:e,w:a}}),new n(t.ns_tts,"overflow","hidden",["region"],!1,!0,function(a){return a},null),new n(t.ns_tts,"padding","0px",["region"],!1,!0,function(a){a=a.split(" ");if(4<a.length)return null;var e=[],g;for(g in a){var l=m.parseLength(a[g]);if(!l)return null;e.push(l)}return e},function(a,e,g,l,n){if(1===l.length)e=[l[0],l[0],l[0],l[0]];else if(2===l.length)e=
[l[0],l[1],l[0],l[1]];else if(3===l.length)e=[l[0],l[1],l[2],l[1]];else if(4===l.length)e=[l[0],l[1],l[2],l[3]];else return null;l=g.styleAttrs[k.byName.writingMode.qname];if("lrtb"===l||"lr"===l)e=[e[0],e[3],e[2],e[1]];else if("rltb"===l||"rl"===l)e=[e[0],e[1],e[2],e[3]];else if("tblr"===l)e=[e[3],e[0],e[1],e[2]];else if("tbrl"===l||"tb"===l)e=[e[3],e[2],e[1],e[0]];else return null;l=[];for(var p in e)if(0===e[p].value)l[p]=new m.ComputedLength(0,0);else if(l[p]=m.toComputedLength(e[p].value,e[p].unit,
g.styleAttrs[k.byName.fontSize.qname],"0"===p||"2"===p?g.styleAttrs[k.byName.extent.qname].h:g.styleAttrs[k.byName.extent.qname].w,"0"===p||"2"===p?a.cellLength.h:a.cellLength.w,"0"===p||"2"===p?a.pxLength.h:a.pxLength.w),null===l[p])return null;return l}),new n(t.ns_tts,"position","top left",["region"],!1,!0,function(a){return m.parsePosition(a)},function(a,e,g,l){e=m.toComputedLength(l.v.offset.value,l.v.offset.unit,null,new m.ComputedLength(-g.styleAttrs[k.byName.extent.qname].h.rw,a.dimensions.h.rh-
g.styleAttrs[k.byName.extent.qname].h.rh),null,a.pxLength.h);if(null===e)return null;"bottom"===l.v.edge&&(e=new m.ComputedLength(-e.rw-g.styleAttrs[k.byName.extent.qname].h.rw,a.dimensions.h.rh-e.rh-g.styleAttrs[k.byName.extent.qname].h.rh));var p=m.toComputedLength(l.h.offset.value,l.h.offset.unit,null,new m.ComputedLength(a.dimensions.w.rw-g.styleAttrs[k.byName.extent.qname].w.rw,-g.styleAttrs[k.byName.extent.qname].w.rh),null,a.pxLength.w);if(null===e)return null;"right"===l.h.edge&&(p=new m.ComputedLength(a.dimensions.w.rw-
p.rw-g.styleAttrs[k.byName.extent.qname].w.rw,-p.rh-g.styleAttrs[k.byName.extent.qname].w.rh));return{h:e,w:p}}),new n(t.ns_tts,"ruby","none",["span"],!1,!0,function(a){return a},null),new n(t.ns_tts,"rubyAlign","center",["span"],!0,!0,function(a){return"center"!==a&&"spaceAround"!==a?null:a},null),new n(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(a){return a},null),new n(t.ns_tts,"rubyReserve","none",["p"],!0,!0,function(a){var e=a.split(" ");a=[null,null];if(0===e.length||2<e.length||
"none"!==e[0]&&"both"!==e[0]&&"after"!==e[0]&&"before"!==e[0]&&"outside"!==e[0])return null;a[0]=e[0];if(2===e.length&&"none"!==e[0])if(e=m.parseLength(e[1]))a[1]=e;else return null;return a},function(a,e,g,l,p){if("none"===l[0])return l;a=null===l[1]?new m.ComputedLength(.5*g.styleAttrs[k.byName.fontSize.qname].rw,.5*g.styleAttrs[k.byName.fontSize.qname].rh):m.toComputedLength(l[1].value,l[1].unit,g.styleAttrs[k.byName.fontSize.qname],g.styleAttrs[k.byName.fontSize.qname],a.cellLength.h,a.pxLength.h);
return null===a?null:[l[0],a]}),new n(t.ns_tts,"showBackground","always",["region"],!1,!0,function(a){return a},null),new n(t.ns_tts,"textAlign","start",["p"],!0,!0,function(a){return a},function(a,e,g,l,k){return"left"===l?"start":"right"===l?"end":l}),new n(t.ns_tts,"textCombine","none",["span"],!0,!0,function(a){return"none"===a||"all"===a?a:null},null),new n(t.ns_tts,"textDecoration","none",["span"],!0,!0,function(a){return a.split(" ")},null),new n(t.ns_tts,"textEmphasis","none",["span"],!0,
!0,function(a){a=a.split(" ");var e={style:null,symbol:null,color:null,position:null},g;for(g in a)if("none"===a[g]||"auto"===a[g])e.style=a[g];else if("filled"===a[g]||"open"===a[g])e.style=a[g];else if("circle"===a[g]||"dot"===a[g]||"sesame"===a[g])e.symbol=a[g];else if("current"===a[g])e.color=a[g];else if("outside"===a[g]||"before"===a[g]||"after"===a[g])e.position=a[g];else if(e.color=m.parseColor(a[g]),null===e.color)return null;null==e.style&&null==e.symbol?e.style="auto":(e.symbol=e.symbol||
"circle",e.style=e.style||"filled");e.position=e.position||"outside";e.color=e.color||"current";return e},null),new n(t.ns_tts,"textOutline","none",["span"],!0,!0,function(a){if("none"===a)return a;var e={};a=a.split(" ");if(0===a.length||2<a.length)return null;var g=m.parseColor(a[0]);e.color=g;null!==g&&a.shift();if(1!==a.length)return null;a=m.parseLength(a[0]);if(!a)return null;e.thickness=a;return e},function(a,e,g,l,p){if("none"===l)return l;e={};e.color=null===l.color?g.styleAttrs[k.byName.color.qname]:
l.color;e.thickness=m.toComputedLength(l.thickness.value,l.thickness.unit,g.styleAttrs[k.byName.fontSize.qname],g.styleAttrs[k.byName.fontSize.qname],a.cellLength.h,a.pxLength.h);return null===e.thickness?null:e}),new n(t.ns_tts,"textShadow","none",["span"],!0,!0,m.parseTextShadow,function(a,e,g,l){if("none"===l)return l;e=[];for(var p in l){var n={};n.x_off=m.toComputedLength(l[p][0].value,l[p][0].unit,null,g.styleAttrs[k.byName.fontSize.qname],null,a.pxLength.w);if(null===n.x_off)return null;n.y_off=
m.toComputedLength(l[p][1].value,l[p][1].unit,null,g.styleAttrs[k.byName.fontSize.qname],null,a.pxLength.h);if(null===n.y_off)return null;if(null===l[p][2])n.b_radius=0;else if(n.b_radius=m.toComputedLength(l[p][2].value,l[p][2].unit,null,g.styleAttrs[k.byName.fontSize.qname],null,a.pxLength.h),null===n.b_radius)return null;n.color=null===l[p][3]?g.styleAttrs[k.byName.color.qname]:l[p][3];e.push(n)}return e}),new n(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(a){return a},null),new n(t.ns_tts,
"visibility","visible",["body","div","p","region","span"],!0,!0,function(a){return a},null),new n(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(a){return a},null),new n(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(a){return a},null),new n(t.ns_tts,"zIndex","auto",["region"],!1,!0,function(a){"auto"!==a&&(a=parseInt(a),isNaN(a)&&(a=null));return a},null),new n(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,m.parseLength,function(a,e,g,l,k){return m.toComputedLength(l.value,l.unit,null,
null,a.cellLength.w,null)}),new n(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(a){return a},null),new n(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(a){return a},null),new n(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(a){return"true"===a?!0:!1},null),new n(t.ns_itts,"fillLineGap","false",["p"],!0,!0,function(a){return"true"===a?!0:!1},null)];k.byQName={};for(var p in k.all)k.byQName[k.all[p].qname]=k.all[p];k.byName={};for(var r in k.all)k.byName[k.all[r].name]=
k.all[r]})("undefined"===typeof r?this.imscStyles={}:r,"undefined"===typeof imscNames?k("./names"):imscNames,"undefined"===typeof imscUtils?k("./utils"):imscUtils)},{"./names":5,"./utils":7}],7:[function(k,v,r){(function(k){var p=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,m=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,n=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,
255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};k.parseColor=function(a){var e,g=null,k=r[a.toLowerCase()];void 0!==k?g=k:null!==(e=p.exec(a))?g=[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),void 0!==e[4]?parseInt(e[4],16):255]:null!==
(e=m.exec(a))?g=[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),255]:null!==(e=n.exec(a))&&(g=[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4])]);return g};var v=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;k.parseLength=function(a){var e,g=null;null!==(e=v.exec(a))&&(g={value:parseFloat(e[1]),unit:e[2]});return g};k.parseTextShadow=function(a){a=a.split(",");var e=[],g;for(g in a){var l=a[g].split(" ");if(1===l.length&&"none"===l[0])return"none";if(1<l.length&&5>l.length){var m=[null,
null,null,null],n=k.parseLength(l.shift());if(null===n)return null;m[0]=n;n=k.parseLength(l.shift());if(null===n)return null;m[1]=n;if(0!==l.length&&(n=k.parseLength(l[0]),null!==n&&(m[2]=n,l.shift()),0!==l.length)){l=k.parseColor(l[0]);if(null===l)return null;m[3]=l}e.push(m)}}return e};k.parsePosition=function(a){a=a.split(" ");var e=function(a){return"center"===a||"left"===a||"top"===a||"bottom"===a||"right"===a};if(4<a.length)return null;for(var g in a)if(!e(a[g])){var l=k.parseLength(a[g]);if(null===
l)return null;a[g]=l}g={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}};for(l=0;l<a.length;){var m=a[l++];if(e(m)){var n={value:0,unit:"%"};2!==a.length&&l<a.length&&!e(a[l])&&(n=a[l++]);"right"===m?(g.h.edge=m,g.h.offset=n):"bottom"===m?(g.v.edge=m,g.v.offset=n):"left"===m?g.h.offset=n:"top"===m&&(g.v.offset=n)}else if(1===a.length||2===a.length)1===l?g.h.offset=m:g.v.offset=m;else return null}return g};k.ComputedLength=function(a,e){this.rw=a;this.rh=e};k.ComputedLength.prototype.toUsedLength=
function(a,e){return a*this.rw+e*this.rh};k.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh};k.toComputedLength=function(a,e,g,l,m,n){return"%"===e&&l?new k.ComputedLength(l.rw*a/100,l.rh*a/100):"em"===e&&g?new k.ComputedLength(g.rw*a,g.rh*a):"c"===e&&m?new k.ComputedLength(a*m.rw,a*m.rh):"px"===e&&n?new k.ComputedLength(a*n.rw,a*n.rh):"rh"===e?new k.ComputedLength(0,a/100):"rw"===e?new k.ComputedLength(a/100,0):null}})("undefined"===typeof r?this.imscUtils={}:r)},{}]},
{},[4])(4)});
